<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width"><title>https://bost.ocks.org/mike/leaflet/</title><link rel="stylesheet" type="text/css" href="resource://content-accessible/viewsource.css"></head><body id="viewsource" class="highlight" style="-moz-tab-size: 4" contextmenu="actions"><pre id="line1"><span></span><span class="doctype">&lt;!DOCTYPE html&gt;</span><span>
<span id="line2"></span></span><span>&lt;<span class="start-tag">html</span> <span class="attribute-name">class</span>="<a class="attribute-value">ocks-org do-not-copy</a>"&gt;</span><span>
<span id="line3"></span></span><span>&lt;<span class="start-tag">meta</span> <span class="attribute-name">charset</span>="<a class="attribute-value">utf-8</a>"&gt;</span><span>
<span id="line4"></span></span><span>&lt;<span class="start-tag">title</span>&gt;</span><span>D3 + Leaflet</span><span>&lt;/<span class="end-tag">title</span>&gt;</span><span>
<span id="line5"></span></span><span>&lt;<span class="start-tag">style</span>&gt;</span><span>
<span id="line6"></span>
<span id="line7"></span>@import url(//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.5/leaflet.css);
<span id="line8"></span>@import url(../style.css?aea6f0a);
<span id="line9"></span>
<span id="line10"></span>#map {
<span id="line11"></span>  width: 960px;
<span id="line12"></span>  height: 500px;
<span id="line13"></span>}
<span id="line14"></span>
<span id="line15"></span>svg {
<span id="line16"></span>  position: relative;
<span id="line17"></span>}
<span id="line18"></span>
<span id="line19"></span>path {
<span id="line20"></span>  fill: #000;
<span id="line21"></span>  fill-opacity: .2;
<span id="line22"></span>  stroke: #fff;
<span id="line23"></span>  stroke-width: 1.5px;
<span id="line24"></span>}
<span id="line25"></span>
<span id="line26"></span>path:hover {
<span id="line27"></span>  fill: brown;
<span id="line28"></span>  fill-opacity: .7;
<span id="line29"></span>}
<span id="line30"></span>
<span id="line31"></span></span><span>&lt;/<span class="end-tag">style</span>&gt;</span><span>
<span id="line32"></span>
<span id="line33"></span></span><span>&lt;<span class="start-tag">header</span>&gt;</span><span>
<span id="line34"></span>  </span><span>&lt;<span class="start-tag">aside</span>&gt;</span><span>June 19, 2012</span><span>&lt;/<span class="end-tag">aside</span>&gt;</span><span>
<span id="line35"></span>  </span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:https://bost.ocks.org/mike/">../</a>" <span class="attribute-name">rel</span>="<a class="attribute-value">author</a>"&gt;</span><span>Mike Bostock</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span>
<span id="line36"></span></span><span>&lt;/<span class="end-tag">header</span>&gt;</span><span>
<span id="line37"></span>
<span id="line38"></span></span><span>&lt;<span class="start-tag">h1</span>&gt;</span><span>D3 + Leaflet</span><span>&lt;/<span class="end-tag">h1</span>&gt;</span><span>
<span id="line39"></span>
<span id="line40"></span></span><span>&lt;<span class="start-tag">p</span> <span class="attribute-name">id</span>="<a class="attribute-value">map</a>"&gt;</span><span>
<span id="line41"></span>
<span id="line42"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span></span><span>&lt;<span class="start-tag">aside</span>&gt;</span><span></span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:https://www.openstreetmap.org/copyright">https://www.openstreetmap.org/copyright</a>"&gt;</span><span>© OpenStreetMap contributors</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span></span><span>&lt;/<span class="end-tag">aside</span>&gt;</span><span>
<span id="line43"></span>
<span id="line44"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>This is a quick demonstration of using </span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:https://d3js.org/">https://d3js.org</a>"&gt;</span><span>D3</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span> to render GeoJSON shapes in conjunction with </span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:http://leafletjs.com/">http://leafletjs.com/</a>"&gt;</span><span>Leaflet</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span>. The implementation is straightforward, but Leaflet is </span><span>&lt;<span class="start-tag">strike</span>&gt;</span><span>regretfully missing </span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:http://leafletjs.com/reference.html">http://leafletjs.com/reference.html</a>"&gt;</span><span>documentation</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span> and </span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:http://leafletjs.com/examples.html">http://leafletjs.com/examples.html</a>"&gt;</span><span>examples</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span> for custom overlays</span><span>&lt;/<span class="end-tag">strike</span>&gt;</span><span>, [EDIT: the documentation has since been updated and there is now a helpful section titled “Implementing Custom Layers”] so hopefully this will help you get started.
<span id="line45"></span>
<span id="line46"></span></span><span>&lt;<span class="start-tag">h2</span>&gt;</span><span></span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:https://bost.ocks.org/mike/leaflet/#init">#init</a>" <span class="attribute-name">name</span>="<a class="attribute-value">init</a>"&gt;</span><span>#</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span>Initializing the Map and SVG Overlay</span><span>&lt;/<span class="end-tag">h2</span>&gt;</span><span>
<span id="line47"></span>
<span id="line48"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>We’ll start with a basic map using OpenStreetMap tiles:
<span id="line49"></span>
<span id="line50"></span></span><span>&lt;<span class="start-tag">pre</span>&gt;</span><span></span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>var map = new L.Map("map", {center: [37.8, -96.9], zoom: 4})
<span id="line51"></span>    .addLayer(new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"));</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span></span><span>&lt;/<span class="end-tag">pre</span>&gt;</span><span>
<span id="line52"></span>
<span id="line53"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>The map is placed inside a paragraph (</span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>p</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span>) element with the id “map”. An associated stylesheet specifies the dimensions:
<span id="line54"></span>
<span id="line55"></span></span><span>&lt;<span class="start-tag">pre</span>&gt;</span><span></span><span>&lt;<span class="start-tag">code</span> <span class="attribute-name">class</span>="<a class="attribute-value">css</a>"&gt;</span><span>#map {
<span id="line56"></span>  width: 960px;
<span id="line57"></span>  height: 500px;
<span id="line58"></span>}</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span></span><span>&lt;/<span class="end-tag">pre</span>&gt;</span><span>
<span id="line59"></span>
<span id="line60"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>Next, we add an SVG element to Leaflet’s </span><span>&lt;<span class="start-tag">i</span>&gt;</span><span>overlay pane</span><span>&lt;/<span class="end-tag">i</span>&gt;</span><span>. Leaflet automatically repositions the overlay pane when the map pans. Note that the SVG element is initialized with no width or height; the dimensions must be set dynamically because they change on zoom. More on that in a bit.
<span id="line61"></span>
<span id="line62"></span></span><span>&lt;<span class="start-tag">pre</span>&gt;</span><span></span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>var svg = d3.select(map.getPanes().overlayPane).append("svg"),
<span id="line63"></span>    g = svg.append("g").attr("class", "leaflet-zoom-hide");</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span></span><span>&lt;/<span class="end-tag">pre</span>&gt;</span><span>
<span id="line64"></span>
<span id="line65"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>Inside the SVG, you’ll also need a G (group) element. This will be used to translate the SVG elements so that the top-left corner of the SVG, ⟨0,0⟩, corresponds to Leaflet’s layer origin. The </span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>leaflet-zoom-hide</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span> class is needed so that the overlay is hidden during Leaflet’s zoom animation; alternatively, you could disable the animation using the </span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>zoomAnimation</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span> option when constructing the map.
<span id="line66"></span>
<span id="line67"></span></span><span>&lt;<span class="start-tag">h2</span>&gt;</span><span></span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:https://bost.ocks.org/mike/leaflet/#project">#project</a>" <span class="attribute-name">name</span>="<a class="attribute-value">project</a>"&gt;</span><span>#</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span>Loading and Projecting GeoJSON</span><span>&lt;/<span class="end-tag">h2</span>&gt;</span><span>
<span id="line68"></span>
<span id="line69"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>Next, we load the GeoJSON file using </span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:https://github.com/mbostock/d3/wiki/Requests#wiki-d3_json">https://github.com/mbostock/d3/wiki/Requests#wiki-d3_json</a>"&gt;</span><span>d3.json</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span>:
<span id="line70"></span>
<span id="line71"></span></span><span>&lt;<span class="start-tag">pre</span>&gt;</span><span></span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>d3.json("us-states.json", function(error, collection) {
<span id="line72"></span>  if (error) throw error;
<span id="line73"></span>
<span id="line74"></span>  // code here
<span id="line75"></span>});</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span></span><span>&lt;/<span class="end-tag">pre</span>&gt;</span><span>
<span id="line76"></span>
<span id="line77"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>The load is asynchronous, so the remaining code in this example is within the callback function. The passed </span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>collection</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span> is the contents of the </span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>us-states.json</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span> file: a single FeatureCollection with features for each of the 50 United States and Puerto Rico.
<span id="line78"></span>
<span id="line79"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>D3 and Leaflet use different APIs for rendering shapes and projecting points. Fortunately, it’s easy to adapt Leaflet’s API to fit D3 by implementing a custom geometric transformation. A </span><span>&lt;<span class="start-tag">i</span>&gt;</span><span>transform</span><span>&lt;/<span class="end-tag">i</span>&gt;</span><span> converts an input geometry (such as polygons in spherical geographic coordinates) to a different output geometry (such as polygons in projected screen coordinates). Using </span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:https://github.com/mbostock/d3/wiki/Geo-Streams#wiki-transform">https://github.com/mbostock/d3/wiki/Geo-Streams#wiki-transform</a>"&gt;</span><span>d3.geo.transform</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span>, it can be implemented as a simple function that projects individual points:
<span id="line80"></span>
<span id="line81"></span></span><span>&lt;<span class="start-tag">aside</span>&gt;</span><span>This code adapts Leaflet’s </span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>latLngToLayerPoint</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span> and </span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>LatLng</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span> methods to project a single point, passing the resulting coordinates to an output </span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:https://github.com/mbostock/d3/wiki/Geo-Streams">https://github.com/mbostock/d3/wiki/Geo-Streams</a>"&gt;</span><span>geometry stream</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span>.</span><span>&lt;/<span class="end-tag">aside</span>&gt;</span><span>
<span id="line82"></span>
<span id="line83"></span></span><span>&lt;<span class="start-tag">pre</span>&gt;</span><span></span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>function projectPoint(x, y) {
<span id="line84"></span>  var point = map.latLngToLayerPoint(new L.LatLng(y, x));
<span id="line85"></span>  this.stream.point(point.x, point.y);
<span id="line86"></span>}</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span></span><span>&lt;/<span class="end-tag">pre</span>&gt;</span><span>
<span id="line87"></span>
<span id="line88"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>Now that we can project points, we can create a </span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:https://github.com/mbostock/d3/wiki/Geo-Paths#wiki-path">https://github.com/mbostock/d3/wiki/Geo-Paths#wiki-path</a>"&gt;</span><span>d3.geo.path</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span> to convert GeoJSON to SVG:
<span id="line89"></span>
<span id="line90"></span></span><span>&lt;<span class="start-tag">pre</span>&gt;</span><span></span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>var transform = d3.geo.transform({point: projectPoint}),
<span id="line91"></span>    path = d3.geo.path().projection(transform);</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span></span><span>&lt;/<span class="end-tag">pre</span>&gt;</span><span>
<span id="line92"></span>
<span id="line93"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>We can also create path elements for each of the features using D3’s </span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:https://bost.ocks.org/mike/join/">../join/</a>"&gt;</span><span>data join</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span>:
<span id="line94"></span>
<span id="line95"></span></span><span>&lt;<span class="start-tag">pre</span>&gt;</span><span></span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>var feature = g.selectAll("path")
<span id="line96"></span>    .data(collection.features)
<span id="line97"></span>  .enter().append("path");</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span></span><span>&lt;/<span class="end-tag">pre</span>&gt;</span><span>
<span id="line98"></span>
<span id="line99"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>The path elements are initially empty; later, we’ll initialize the path data by setting the </span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>d</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span> attribute:
<span id="line100"></span>
<span id="line101"></span></span><span>&lt;<span class="start-tag">pre</span>&gt;</span><span></span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>feature.attr("d", path);</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span></span><span>&lt;/<span class="end-tag">pre</span>&gt;</span><span>
<span id="line102"></span>
<span id="line103"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>The </span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:https://github.com/mbostock/d3/wiki/Selections#wiki-attr">https://github.com/mbostock/d3/wiki/Selections#wiki-attr</a>"&gt;</span><span>selection.attr</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span> method computes the path data for each feature. The path elements are bound to the associated GeoJSON feature, so these features are fed to the path generator (a d3.geo.path), which calls our custom projection, which in turn uses Leaflet’s projection. Still following?
<span id="line104"></span>
<span id="line105"></span></span><span>&lt;<span class="start-tag">h2</span>&gt;</span><span></span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:https://bost.ocks.org/mike/leaflet/#fit">#fit</a>" <span class="attribute-name">name</span>="<a class="attribute-value">fit</a>"&gt;</span><span>#</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span>Fitting SVG to a Layer</span><span>&lt;/<span class="end-tag">h2</span>&gt;</span><span>
<span id="line106"></span>
<span id="line107"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>One additional wrench: how big should the SVG element be? Unfortunately, it can’t simply be 960×500 because the user can zoom and pan; the size depends on the displayed geographic features and the current zoom level!
<span id="line108"></span>
<span id="line109"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>It can be difficult to compute a bounding box with arbitrary projections, but fortunately D3 provides a convenient mechanism for computing the </span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:https://github.com/mbostock/d3/wiki/Geo-Paths#wiki-path_bounds">https://github.com/mbostock/d3/wiki/Geo-Paths#wiki-path_bounds</a>"&gt;</span><span>projected bounding box</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span> of our features using our custom transform to convert the longitude and latitude to pixels:
<span id="line110"></span>
<span id="line111"></span></span><span>&lt;<span class="start-tag">pre</span>&gt;</span><span></span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>var bounds = path.bounds(collection),
<span id="line112"></span>    topLeft = bounds[0],
<span id="line113"></span>    bottomRight = bounds[1];</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span></span><span>&lt;/<span class="end-tag">pre</span>&gt;</span><span>
<span id="line114"></span>
<span id="line115"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>Now we can set the dimensions of the SVG with sufficient padding to display features above or to the left of the origin. The layer origin is arbitrary, so sometimes you need to draw above and to the left of the origin; without this extra padding, the top-left corner would be clipped and some features would be invisible. (Note that since we’re setting the left and top styles, we rely on the SVG element being position: relative.)
<span id="line116"></span>
<span id="line117"></span></span><span>&lt;<span class="start-tag">pre</span>&gt;</span><span></span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>svg .attr("width", bottomRight[0] - topLeft[0])
<span id="line118"></span>    .attr("height", bottomRight[1] - topLeft[1])
<span id="line119"></span>    .style("left", topLeft[0] + "px")
<span id="line120"></span>    .style("top", topLeft[1] + "px");
<span id="line121"></span>
<span id="line122"></span>g   .attr("transform", "translate(" + -topLeft[0] + "," + -topLeft[1] + ")");</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span></span><span>&lt;/<span class="end-tag">pre</span>&gt;</span><span>
<span id="line123"></span>
<span id="line124"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>Lastly, the above code is hooked up to Leaflet’s </span><span>&lt;<span class="start-tag">code</span>&gt;</span><span>viewreset</span><span>&lt;/<span class="end-tag">code</span>&gt;</span><span> event, so that the SVG can be repositioned and rerendered whenever the map zooms. </span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:view-source:https://bost.ocks.org/mike/leaflet/">view-source:https://bost.ocks.org/mike/leaflet/</a>"&gt;</span><span>View-source</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span> to see the full code.
<span id="line125"></span>
<span id="line126"></span></span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>Happy mapping!
<span id="line127"></span>
<span id="line128"></span></span><span>&lt;<span class="start-tag">footer</span>&gt;</span><span>
<span id="line129"></span>  </span><span>&lt;<span class="start-tag">aside</span>&gt;</span><span>June 19, 2012</span><span>&lt;/<span class="end-tag">aside</span>&gt;</span><span>
<span id="line130"></span>  </span><span>&lt;<span class="start-tag">a</span> <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:https://bost.ocks.org/mike/">../</a>" <span class="attribute-name">rel</span>="<a class="attribute-value">author</a>"&gt;</span><span>Mike Bostock</span><span>&lt;/<span class="end-tag">a</span>&gt;</span><span>
<span id="line131"></span></span><span>&lt;/<span class="end-tag">footer</span>&gt;</span><span>
<span id="line132"></span>
<span id="line133"></span></span><span>&lt;<span class="start-tag">script</span> <span class="attribute-name">src</span>="<a class="attribute-value" href="view-source:https://d3js.org/d3.v3.min.js">//d3js.org/d3.v3.min.js</a>" <span class="attribute-name">charset</span>="<a class="attribute-value">utf-8</a>"&gt;</span><span></span><span>&lt;/<span class="end-tag">script</span>&gt;</span><span>
<span id="line134"></span></span><span>&lt;<span class="start-tag">script</span> <span class="attribute-name">src</span>="<a class="attribute-value" href="view-source:https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.5/leaflet.js">https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.5/leaflet.js</a>"&gt;</span><span></span><span>&lt;/<span class="end-tag">script</span>&gt;</span><span>
<span id="line135"></span></span><span>&lt;<span class="start-tag">script</span>&gt;</span><span>
<span id="line136"></span>
<span id="line137"></span>var map = new L.Map("map", {center: [37.8, -96.9], zoom: 4})
<span id="line138"></span>    .addLayer(new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"));
<span id="line139"></span>
<span id="line140"></span>var svg = d3.select(map.getPanes().overlayPane).append("svg"),
<span id="line141"></span>    g = svg.append("g").attr("class", "leaflet-zoom-hide");
<span id="line142"></span>
<span id="line143"></span>d3.json("us-states.json", function(error, collection) {
<span id="line144"></span>  if (error) throw error;
<span id="line145"></span>
<span id="line146"></span>  var transform = d3.geo.transform({point: projectPoint}),
<span id="line147"></span>      path = d3.geo.path().projection(transform);
<span id="line148"></span>
<span id="line149"></span>  var feature = g.selectAll("path")
<span id="line150"></span>      .data(collection.features)
<span id="line151"></span>    .enter().append("path");
<span id="line152"></span>
<span id="line153"></span>  map.on("viewreset", reset);
<span id="line154"></span>  reset();
<span id="line155"></span>
<span id="line156"></span>  // Reposition the SVG to cover the features.
<span id="line157"></span>  function reset() {
<span id="line158"></span>    var bounds = path.bounds(collection),
<span id="line159"></span>        topLeft = bounds[0],
<span id="line160"></span>        bottomRight = bounds[1];
<span id="line161"></span>
<span id="line162"></span>    svg .attr("width", bottomRight[0] - topLeft[0])
<span id="line163"></span>        .attr("height", bottomRight[1] - topLeft[1])
<span id="line164"></span>        .style("left", topLeft[0] + "px")
<span id="line165"></span>        .style("top", topLeft[1] + "px");
<span id="line166"></span>
<span id="line167"></span>    g   .attr("transform", "translate(" + -topLeft[0] + "," + -topLeft[1] + ")");
<span id="line168"></span>
<span id="line169"></span>    feature.attr("d", path);
<span id="line170"></span>  }
<span id="line171"></span>
<span id="line172"></span>  // Use Leaflet to implement a D3 geometric transformation.
<span id="line173"></span>  function projectPoint(x, y) {
<span id="line174"></span>    var point = map.latLngToLayerPoint(new L.LatLng(y, x));
<span id="line175"></span>    this.stream.point(point.x, point.y);
<span id="line176"></span>  }
<span id="line177"></span>});
<span id="line178"></span>
<span id="line179"></span></span><span>&lt;/<span class="end-tag">script</span>&gt;</span><span>
<span id="line180"></span></span><span>&lt;<span class="start-tag">script</span>&gt;</span><span>
<span id="line181"></span>
<span id="line182"></span>GoogleAnalyticsObject = "ga", ga = function() { ga.q.push(arguments); }, ga.q = [], ga.l = +new Date;
<span id="line183"></span>ga("create", "UA-48272912-3", "ocks.org");
<span id="line184"></span>ga("send", "pageview");
<span id="line185"></span>
<span id="line186"></span></span><span>&lt;/<span class="end-tag">script</span>&gt;</span><span>
<span id="line187"></span></span><span>&lt;<span class="start-tag">script</span> <span class="attribute-name">async</span> <span class="attribute-name">src</span>="<a class="attribute-value" href="view-source:https://bost.ocks.org/mike/highlight.min.js">../highlight.min.js</a>"&gt;</span><span></span><span>&lt;/<span class="end-tag">script</span>&gt;</span><span>
<span id="line188"></span></span><span>&lt;<span class="start-tag">script</span> <span class="attribute-name">async</span> <span class="attribute-name">src</span>="<a class="attribute-value" href="view-source:https://www.google-analytics.com/analytics.js">//www.google-analytics.com/analytics.js</a>"&gt;</span><span></span><span>&lt;/<span class="end-tag">script</span>&gt;</span><span>
<span id="line189"></span></span></pre><menu type="context" id="actions"><menuitem id="goToLine" label="Go to Line…" accesskey="L"></menuitem><menuitem id="wrapLongLines" label="Wrap Long Lines" type="checkbox"></menuitem><menuitem id="highlightSyntax" label="Syntax Highlighting" type="checkbox" checked="true"></menuitem></menu></body></html>